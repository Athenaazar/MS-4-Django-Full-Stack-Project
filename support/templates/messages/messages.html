{% extends 'base.html' %}
{% load static %}
{% load thumbnail %}
{% load crispy_forms_tags %}

{% block page_header %}
<!-- Header-->
<header class="bg-black py-5">
    <div class="container px-4 px-lg-5 my-5">
        <div class="text-center">

            <h1 class="display-4 fw-bolder">Support</h1>

        </div>
    </div>
</header>
{% endblock %}
{% block content %}

<!-- Product Detail section-->
<section class="page-section">

    <div class="mx-auto col-12 col-sm-8 col-lg-6 px-4">

        <h4 class="">{{ issue }}</h4>
        {% if issue.order_line %}
        
        <p class="p-0 text-muted text-italic">Product: {{ issue.order_line }}</p>
        {% endif %}
        {% if issue.status == 'Resolved' %}
        <p class="m-0 text-success fw-bolder font-monospace">Status: {{ issue.status }}</p>
        {% else %}
        <p class="m-0 text-danger fw-bolder font-monospace">Status: {{ issue.status }}</p>
        {% endif %}
        {% for message in thread_messages %}

        {% if message.user.is_superuser %}
        <div class="mt-3">
            <div class="bg-white shadow-sm border rounded p-3">
                <p class="m-0 fw-bolder text-muted text-italic text-capitalize">{{ message.user.username }}</p>
                <p class="m-0 time font-monospace">{{ message.timestamp }}</p>
                
                <div class="text bg-light p-2 shadow-sm">
                    <p class="message fw-bolder font-monospace">{{ message.message }}</p>
                </div>
            </div>
        </div>
    
        {% else %}
        <div class="mt-3">
            <div class="bg-white shadow-sm border rounded p-3">

                 <p class="m-0 fw-bolder text-muted text-italic text-capitalize">{{ message.user.username }}</p>
                <p class="m-0 time font-monospace">{{ message.timestamp }}</p>
               
                <div class="text bg-light p-2 shadow-sm">
                    <p class="message fw-bolder font-monospace">{{ message.message }}</p>
                </div>
            </div>
        </div>
  
        {% endif %}
        {% endfor %}

        <form id="support-form" action="" class="form" method="POST" novalidate>
            {% csrf_token %}
            <div class="font-monospace">
                {{ form|crispy }}
            </div>
            <button id="review-submit" class="btn btn-dark btn-xl text-uppercase flex-shrink-0" type="submit">
                Submit
            </button>
        </form>

       
        {% if request.user.is_superuser %}
        <hr>
        <form class="form form-status" method="POST" action="{% url 'messages_view' issue.id %}">
            {% csrf_token %}
            <div class="form-group m-0">
                <p class="text-muted text-italic">Change current issue status</p>
                <div class="input-group d-flex">

                    <div class="col-6 col-md-3">

                        <div class="text-italic fw-bolder">
                            {{ status_form|crispy }}
                        </div>

                        <button type='submit' class='btn btn-dark w-100'>
                            Update
                        </button>
                    </div>

                </div>
            </div>
        </form>
        {% endif %}
    </div>
    </div>
</section>

{% endblock %}